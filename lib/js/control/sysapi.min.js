var ENVJSON,NODE_ENV,PATHINFO,Promise,SUBPATH,__sysjsctrl,__sysjsdir,__systemdir,bind_router,config,echo,envpath,express,fs,path,pathinfo,router;Promise=require("bluebird"),router=(express=require("express")).Router(),path=require("path"),config=require("config"),echo=require("ndlog").echo,bind_router=global.BIND_ROUTER,fs=require("fs-extra"),pathinfo=require(`${PLUSTICKLIBS}/pathinfo.min.js`),router.use(express.json()),router.use(express.urlencoded({extended:!0})),NODE_ENV=process.env.NODE_ENV,__systemdir=fs.realpathSync(__dirname+"/../../.."),PATHINFO=require(`${__sysjsctrl=`${__sysjsdir=`${__systemdir}/lib/js`}/control`}/pathinfo.min.js`),envpath=(ENVJSON="develop"===NODE_ENV?require(`${PATHINFO.appsdir}/config/develop.json`):require(`${PATHINFO.appsdir}/config/default.json`)).application.path,SUBPATH=""===envpath?"":`/${envpath}`,router.all("/:endpoint",async function(e,r){var i,n,s,o,t,a,p,u,d,f,_,l;if(d=e.method,n=e.params.endpoint,i=e.body,f=e.query,(o=e.headers).method=d,"develop"===NODE_ENV||`${o.origin}${SUBPATH}`===(o.referer.replace(/\/\?.*$/,"")||"").replace(/\/$/,"")){if("__getappsinfo__"===n){for(_=function(e){return new Promise(function(r,i){return fs.readdir(e,function(e,n){return e?i(e):r(n)})})},a={},u=await _(pathinfo.usrjsview).catch(e=>console.log(e)),a.userjsview=[],t=0,p=u.length;t<p;t++)(s=u[t]).match(/^.*\.min\.js$/)&&null===s.match(/appsmain\.min\.js$/)&&a.userjsview.push(`${pathinfo.pkgname}/view/${s}`);return r.json({jrror:0,pathinfo:pathinfo,jsfilelist:a})}return null!=bind_router[n]&&"function"==typeof bind_router[n]?(l=await bind_router[n](o,i,f),r.json(l)):void 0}r.json(-1)}),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsiRU5WSlNPTiIsIk5PREVfRU5WIiwiUEFUSElORk8iLCJQcm9taXNlIiwiU1VCUEFUSCIsIl9fc3lzanNjdHJsIiwiX19zeXNqc2RpciIsIl9fc3lzdGVtZGlyIiwiYmluZF9yb3V0ZXIiLCJjb25maWciLCJlY2hvIiwiZW52cGF0aCIsImV4cHJlc3MiLCJmcyIsInBhdGgiLCJwYXRoaW5mbyIsInJvdXRlciIsInJlcXVpcmUiLCJSb3V0ZXIiLCJnbG9iYWwiLCJCSU5EX1JPVVRFUiIsIlBMVVNUSUNLTElCUyIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJwcm9jZXNzIiwiZW52IiwicmVhbHBhdGhTeW5jIiwiX19kaXJuYW1lIiwiYXBwc2RpciIsImFwcGxpY2F0aW9uIiwiYWxsIiwiYXN5bmMiLCJyZXEiLCJyZXMiLCJkYXRhIiwiZW5kcG9pbnQiLCJmbmFtZSIsImhlYWRlcnMiLCJpIiwianNmaWxlbGlzdCIsImxlbiIsImxpc3RzIiwibWV0aG9kIiwicXVlcnkiLCJyZWFkRmlsZUxpc3QiLCJyZXQiLCJwYXJhbXMiLCJib2R5Iiwib3JpZ2luIiwicmVmZXJlciIsInJlcGxhY2UiLCJyZXNvbHZlIiwicmVqZWN0IiwicmVhZGRpciIsImVyciIsInVzcmpzdmlldyIsImNhdGNoIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJtYXRjaCIsInB1c2giLCJwa2duYW1lIiwianJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxRQUFTQyxTQUFVQyxTQUFVQyxRQUFTQyxRQUFTQyxZQUFhQyxXQUFZQyxZQUFhQyxZQUFhQyxPQUFRQyxLQUFNQyxRQUFTQyxRQUFTQyxHQUFJQyxLQUFNQyxTQUFVQyxPQUUxSmIsUUFBVWMsUUFBUSxZQUlsQkQsUUFGQUosUUFBVUssUUFBUSxZQUVEQyxTQUVqQkosS0FBT0csUUFBUSxRQUVmUixPQUFTUSxRQUFRLFVBRWpCUCxLQUFPTyxRQUFRLFNBQVNQLEtBRXhCRixZQUFjVyxPQUFPQyxZQUVyQlAsR0FBS0ksUUFBUSxZQUViRixTQUFXRSxXQUFXSSxnQ0FFdEJMLE9BQU9NLElBQUlWLFFBQVFXLFFBRW5CUCxPQUFPTSxJQUFJVixRQUFRWSxXQUFXLENBQzVCQyxVQUFVLEtBR1p4QixTQUFXeUIsUUFBUUMsSUFBYyxTQUVqQ3BCLFlBQWNNLEdBQUdlLGFBQWFDLFVBQVksYUFNMUMzQixTQUFXZSxXQUZYWixlQUZBQyxjQUFnQkMsa0RBWWhCSSxTQUxFWCxRQURlLFlBQWJDLFNBQ1FnQixXQUFXZixTQUFTNEIsK0JBRXBCYixXQUFXZixTQUFTNEIsZ0NBR2RDLFlBQVlqQixLQUc1QlYsUUFEYyxLQUFaTyxRQUNRLE9BRUlBLFVBTWhCSyxPQUFPZ0IsSUFBSSxhQUFjQyxlQUFlQyxFQUFLQyxHQUMzQyxJQUFJQyxFQUFNQyxFQUFVQyxFQUFPQyxFQUFTQyxFQUFHQyxFQUFZQyxFQUFLQyxFQUFPQyxFQUFnQkMsRUFBT0MsRUFBdUJDLEVBTzdHLEdBTkFILEVBQVNWLEVBQUlVLE9BQ2JQLEVBQVdILEVBQUljLE9BQU9YLFNBQ3RCRCxFQUFPRixFQUFJZSxLQUNYSixFQUFRWCxFQUFJVyxPQUNaTixFQUFVTCxFQUFJSyxTQUNFLE9BQUlLLEVBQ0gsWUFBYjNDLGFBQ1VzQyxFQUFRVyxTQUFTOUMsYUFDbkJtQyxFQUFRWSxRQUFRQyxRQUFRLFVBQVcsS0FBTyxJQUM3QkEsUUFBUSxNQUFPLElBSHhDLENBV0EsR0FBaUIsb0JBQWJmLEVBQWdDLENBa0JsQyxJQWpCQVMsRUFBZSxTQUFTaEMsR0FDdEIsT0FBTyxJQUFJWCxRQUFRLFNBQVNrRCxFQUFTQyxHQUNuQyxPQUFPekMsR0FBRzBDLFFBQVF6QyxFQUFNLFNBQVMwQyxFQUFLYixHQUNwQyxPQUFJYSxFQUNLRixFQUFPRSxHQUVQSCxFQUFRVixRQU12QkYsRUFBYSxHQUNiRSxRQUFlRyxFQUFhL0IsU0FBUzBDLFdBQVdDLE1BQU9DLEdBQzlDQyxRQUFRQyxJQUFJRixJQUVyQmxCLEVBQXVCLFdBQUksR0FDdEJELEVBQUksRUFBR0UsRUFBTUMsRUFBTW1CLE9BQVF0QixFQUFJRSxFQUFLRixLQUN2Q0YsRUFBUUssRUFBTUgsSUFDSnVCLE1BQU0sa0JBQzRCLE9BQXRDekIsRUFBTXlCLE1BQU0sdUJBQ2R0QixFQUF1QixXQUFFdUIsUUFBUWpELFNBQVNrRCxnQkFBZ0IzQixLQUloRSxPQUFPSCxFQUFJWixLQUFLLENBQ2QyQyxNQUFPLEVBQ1BuRCxTQUFVQSxTQUNWMEIsV0FBWUEsSUFHZCxPQUE4QixNQUF6QmpDLFlBQVk2QixJQUF1RCxtQkFBMUI3QixZQUFZNkIsSUFDeERVLFFBQWF2QyxZQUFZNkIsR0FBVUUsRUFBU0gsRUFBTVMsR0FDM0NWLEVBQUlaLEtBQUt3QixTQUZsQixFQXZDRVosRUFBSVosTUFBTSxLQThDaEI0QyxPQUFPQyxRQUFVcEQifQ==