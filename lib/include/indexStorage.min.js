var indexStorage;indexStorage=class{constructor(e){this.node_env=null!=e&&e.NODE_ENV||"",this.version=1,this.__indexDBObj=void 0,this.__IDBTransactionObj=void 0,this.__IDBKeyRangeObj=void 0,this.__database=void 0,window.indexedDB&&(this.__indexDBObj=window.indexedDB,this.__IDBTransactionObj=window.IDBTransaction,this.__IDBKeyRangeObj=window.IDBKeyRange,"develop"===this.node_env?this.__dbname="__indexstorage_db_develop__":this.__dbname="__indexstorage_db_production__")}__connectDB(){return new Promise((e,t)=>{var r;return(r=this.__indexDBObj.open(this.__dbname,this.version)).onupgradeneeded=(e=>{var t,r,a;return(a=(t=e.target.result).createObjectStore("indexStorage",{keyPath:"key"})).createIndex("primary_key","key",{unique:!0,multiEntry:!1}),(a=t.createObjectStore("preference",{keyPath:"key"})).createIndex("primary_key","key",{unique:!0,multiEntry:!1}),r=[],a.put({key:"keylist",val:r})}),r.onsuccess=(t=>(this.__database=t.target.result,e(!0))),r.onerror=(e=>t(!1))})}__addKeylist(e){return new Promise(async(t,r)=>{var a;return(a=await this.getItem("keylist","preference")||[]).indexOf(e)<0&&(a.push(e),await this.setItem("keylist",a,"preference")),t(a)})}__removeKeylist(e){return new Promise(async(t,r)=>{var a,n;return(a=(n=await this.getItem("keylist","preference")||[]).indexOf(e))>=0&&(n.splice(a,1),await this.setItem("keylist",n,"preference")),t(n)})}length(){return new Promise(async(e,t)=>{var r,a;try{return await this.__connectDB(),r=this.__database.transaction(["indexStorage"],"readonly").objectStore("indexStorage"),(a=r.count()).onerror=(e=>(this.__database.close(),t(void 0))),a.onsuccess=(t=>{var r;return r=a.result,e(r)})}catch(e){}})}key(e){return new Promise(async(t,r)=>{try{return t((await this.getItem("keylist","preference")||[])[parseInt(e)])}catch(e){return e,r(void 0)}})}getItem(e,t="indexStorage"){return new Promise(async(r,a)=>{var n,s;return await this.__connectDB(),n=this.__database.transaction([t],"readonly").objectStore(t),(s=n.get(e)).onerror=(e=>(this.__database.close(),a(void 0))),s.onsuccess=(t=>{var a;return a=void 0,null!=s.result&&s.result.key===e&&(a=s.result.val),this.__database.close(),r(a)})})}setItem(e,t,r="indexStorage"){return new Promise(async(a,n)=>{var s;return await this.__connectDB(),(s=this.__database.transaction([r],"readwrite")).objectStore(r).put({key:e,val:t}),"indexStorage"===r&&await this.__addKeylist(e),s.onerror=(e=>(this.__database.close(),n(!1))),s.oncomplete=(e=>(this.__database.close(),a(!0)))})}removeItem(e,t="indexStorage"){return new Promise(async(r,a)=>{var n;return await this.__connectDB(),(n=this.__database.transaction([t],"readwrite").objectStore(t).delete(e)).onerror=(e=>(this.__database.close(),a(!1))),n.onsuccess=(async t=>(await this.__removeKeylist(e),this.__database.close(),r(!0)))})}clear(){return new Promise(async(e,t)=>{var r;return r=await this.__clearObjectStore("indexStorage"),e(r|=await this.__clearObjectStore("preference"))})}delete(e=this.__dbname){return echo("database=%@",e),this.__indexDBObj.deleteDatabase(e)}__clearObjectStore(e="indexStorage"){return new Promise(async(t,r)=>{var a;return await this.__connectDB(),(a=this.__database.transaction([e],"readwrite").objectStore(e).clear()).onerror=(e=>(this.__database.close(),r(!1))),a.onsuccess=(e=>(this.__database.close(),t(!0)))})}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAiXSwibmFtZXMiOlsiaW5kZXhTdG9yYWdlIiwiW29iamVjdCBPYmplY3RdIiwicGFyYW0iLCJ0aGlzIiwibm9kZV9lbnYiLCJOT0RFX0VOViIsInZlcnNpb24iLCJfX2luZGV4REJPYmoiLCJfX0lEQlRyYW5zYWN0aW9uT2JqIiwiX19JREJLZXlSYW5nZU9iaiIsIl9fZGF0YWJhc2UiLCJ3aW5kb3ciLCJpbmRleGVkREIiLCJJREJUcmFuc2FjdGlvbiIsIklEQktleVJhbmdlIiwiX19kYm5hbWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlcU9iaiIsIm9wZW4iLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsImRiIiwia2V5bGlzdCIsIm9ianN0b3JlIiwidGFyZ2V0IiwicmVzdWx0IiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwiY3JlYXRlSW5kZXgiLCJ1bmlxdWUiLCJtdWx0aUVudHJ5IiwicHV0Iiwia2V5IiwidmFsIiwib25zdWNjZXNzIiwib25lcnJvciIsImFzeW5jIiwiZ2V0SXRlbSIsImluZGV4T2YiLCJwdXNoIiwic2V0SXRlbSIsImluZGV4Iiwic3BsaWNlIiwib2JqZWN0U3RvcmUiLCJyZXF1ZXN0IiwiX19jb25uZWN0REIiLCJ0cmFuc2FjdGlvbiIsImNvdW50IiwiY2xvc2UiLCJsZW4iLCJlcnJvciIsInBhcnNlSW50Iiwic3RvcmVuYW1lIiwiZ2V0IiwiX19hZGRLZXlsaXN0Iiwib25jb21wbGV0ZSIsImRlbGV0ZSIsIl9fcmVtb3ZlS2V5bGlzdCIsInJldCIsIl9fY2xlYXJPYmplY3RTdG9yZSIsImRhdGFiYXNlIiwiZWNobyIsImRlbGV0ZURhdGFiYXNlIiwiY2xlYXIiXSwibWFwcGluZ3MiOiJBQUtBLElBQUlBLGFBRUpBLGFBQWUsTUFDYkMsWUFBWUMsR0FHUkMsS0FBS0MsU0FETyxNQUFURixHQUNhQSxFQUFNRyxVQUVOLEdBR2xCRixLQUFLRyxRQUFVLEVBRWZILEtBQUtJLGtCQUFlLEVBQ3BCSixLQUFLSyx5QkFBc0IsRUFDM0JMLEtBQUtNLHNCQUFtQixFQUN4Qk4sS0FBS08sZ0JBQWEsRUFDZEMsT0FBT0MsWUFDVFQsS0FBS0ksYUFBZUksT0FBT0MsVUFDM0JULEtBQUtLLG9CQUFzQkcsT0FBT0UsZUFDbENWLEtBQUtNLGlCQUFtQkUsT0FBT0csWUFNWCxZQUFsQlgsS0FBS0MsU0FDUEQsS0FBS1ksU0FBVyw4QkFFaEJaLEtBQUtZLFNBQVcsa0NBV3BCZCxjQUNFLE9BQU8sSUFBSWUsUUFBUSxDQUFDQyxFQUFTQyxLQUMzQixJQUFJQyxFQStCSixPQTdCQUEsRUFBU2hCLEtBQUtJLGFBQWFhLEtBQUtqQixLQUFLWSxTQUFVWixLQUFLRyxVQUU3Q2UsZ0JBQWtCLENBQUNDLElBQ3hCLElBQUlDLEVBQUlDLEVBQVNDLEVBaUJqQixPQWZBQSxHQURBRixFQUFLRCxFQUFNSSxPQUFPQyxRQUNKQyxrQkFBa0IsZUFBZ0IsQ0FDOUNDLFFBQVMsU0FFRkMsWUFBWSxjQUFlLE1BQU8sQ0FDekNDLFFBQVEsRUFDUkMsWUFBWSxLQUVkUCxFQUFXRixFQUFHSyxrQkFBa0IsYUFBYyxDQUM1Q0MsUUFBUyxTQUVGQyxZQUFZLGNBQWUsTUFBTyxDQUN6Q0MsUUFBUSxFQUNSQyxZQUFZLElBRWRSLEVBQVUsR0FDSEMsRUFBU1EsSUFBSSxDQUNsQkMsSUFBSyxVQUNMQyxJQUFLWCxNQUdUTCxFQUFPaUIsVUFBWSxDQUFDZCxJQUNsQm5CLEtBQUtPLFdBQWFZLEVBQU1JLE9BQU9DLE9BQ3hCVixHQUFRLEtBRVZFLEVBQU9rQixRQUFVLENBQUNmLEdBQ2hCSixHQUFPLE1BUXBCakIsYUFBYWlDLEdBQ1gsT0FBTyxJQUFJbEIsUUFBUXNCLE1BQU1yQixFQUFTQyxLQUNoQyxJQUFJTSxFQU1KLE9BTEFBLFFBQWlCckIsS0FBS29DLFFBQVEsVUFBVyxlQUFrQixJQUMvQ0MsUUFBUU4sR0FBTyxJQUN6QlYsRUFBUWlCLEtBQUtQLFNBQ1AvQixLQUFLdUMsUUFBUSxVQUFXbEIsRUFBUyxlQUVsQ1AsRUFBUU8sS0FPbkJ2QixnQkFBZ0JpQyxHQUNkLE9BQU8sSUFBSWxCLFFBQVFzQixNQUFNckIsRUFBU0MsS0FDaEMsSUFBSXlCLEVBQU9uQixFQU9YLE9BTEFtQixHQURBbkIsUUFBaUJyQixLQUFLb0MsUUFBUSxVQUFXLGVBQWtCLElBQzNDQyxRQUFRTixLQUNYLElBQ1hWLEVBQVFvQixPQUFPRCxFQUFPLFNBQ2hCeEMsS0FBS3VDLFFBQVEsVUFBV2xCLEVBQVMsZUFFbENQLEVBQVFPLEtBV25CdkIsU0FDRSxPQUFPLElBQUllLFFBQVFzQixNQUFNckIsRUFBU0MsS0FDaEMsSUFBSTJCLEVBQWFDLEVBQ2pCLElBU0UsYUFSTTNDLEtBQUs0QyxjQUVYRixFQURjMUMsS0FBS08sV0FBV3NDLFlBQVksQ0FBQyxnQkFBaUIsWUFDbENILFlBQVksaUJBQ3RDQyxFQUFVRCxFQUFZSSxTQUNkWixRQUFVLENBQUNmLElBQ2pCbkIsS0FBS08sV0FBV3dDLFFBQ1RoQyxPQUFPLEtBRVQ0QixFQUFRVixVQUFZLENBQUNkLElBQzFCLElBQUk2QixFQUVKLE9BREFBLEVBQU1MLEVBQVFuQixPQUNQVixFQUFRa0MsS0FFakIsTUFBT0MsT0FPYm5ELElBQUkwQyxHQUNGLE9BQU8sSUFBSTNCLFFBQVFzQixNQUFNckIsRUFBU0MsS0FFaEMsSUFHRSxPQUFPRCxTQUZVZCxLQUFLb0MsUUFBUSxVQUFXLGVBQWtCLElBQzdDYyxTQUFTVixLQUV2QixNQUFPUyxHQUVQLE9BRElBLEVBQ0dsQyxPQUFPLE1BUXBCakIsUUFBUWlDLEVBQUtvQixFQUFZLGdCQUN2QixPQUFPLElBQUl0QyxRQUFRc0IsTUFBTXJCLEVBQVNDLEtBQ2hDLElBQUkyQixFQUFhQyxFQVNqQixhQVJNM0MsS0FBSzRDLGNBRVhGLEVBRGMxQyxLQUFLTyxXQUFXc0MsWUFBWSxDQUFDTSxHQUFZLFlBQzdCVCxZQUFZUyxJQUN0Q1IsRUFBVUQsRUFBWVUsSUFBSXJCLElBQ2xCRyxRQUFVLENBQUNmLElBQ2pCbkIsS0FBS08sV0FBV3dDLFFBQ1RoQyxPQUFPLEtBRVQ0QixFQUFRVixVQUFZLENBQUNkLElBQzFCLElBQUlhLEVBTUosT0FMQUEsT0FBTSxFQUNpQixNQUFsQlcsRUFBUW5CLFFBQW1CbUIsRUFBUW5CLE9BQVksTUFBTU8sSUFDeERDLEVBQU1XLEVBQVFuQixPQUFPUSxLQUV2QmhDLEtBQUtPLFdBQVd3QyxRQUNUakMsRUFBUWtCLE9BUXJCbEMsUUFBUWlDLEVBQUtDLEVBQUttQixFQUFZLGdCQUM1QixPQUFPLElBQUl0QyxRQUFRc0IsTUFBTXJCLEVBQVNDLEtBQ2hDLElBQWlCOEIsRUFlakIsYUFkTTdDLEtBQUs0QyxlQUNYQyxFQUFjN0MsS0FBS08sV0FBV3NDLFlBQVksQ0FBQ00sR0FBWSxjQUM3QlQsWUFBWVMsR0FDMUJyQixJQUFJLENBQ2RDLElBQUtBLEVBQ0xDLElBQUtBLElBRVcsaUJBQWRtQixTQUNJbkQsS0FBS3FELGFBQWF0QixHQUUxQmMsRUFBWVgsUUFBVSxDQUFDZixJQUNyQm5CLEtBQUtPLFdBQVd3QyxRQUNUaEMsR0FBTyxLQUVUOEIsRUFBWVMsV0FBYSxDQUFDbkMsSUFDL0JuQixLQUFLTyxXQUFXd0MsUUFDVGpDLEdBQVEsT0FRckJoQixXQUFXaUMsRUFBS29CLEVBQVksZ0JBQzFCLE9BQU8sSUFBSXRDLFFBQVFzQixNQUFNckIsRUFBU0MsS0FDaEMsSUFBaUI0QixFQVNqQixhQVJNM0MsS0FBSzRDLGVBR1hELEVBRmMzQyxLQUFLTyxXQUFXc0MsWUFBWSxDQUFDTSxHQUFZLGFBQzdCVCxZQUFZUyxHQUNoQkksT0FBT3hCLElBQ3JCRyxRQUFVLENBQUNmLElBQ2pCbkIsS0FBS08sV0FBV3dDLFFBQ1RoQyxHQUFPLEtBRVQ0QixFQUFRVixVQUFZRSxPQUFNaEIsVUFDekJuQixLQUFLd0QsZ0JBQWdCekIsR0FDM0IvQixLQUFLTyxXQUFXd0MsUUFDVGpDLEdBQVEsT0FRckJoQixRQUNFLE9BQU8sSUFBSWUsUUFBUXNCLE1BQU1yQixFQUFTQyxLQUNoQyxJQUFJMEMsRUFHSixPQUZBQSxRQUFhekQsS0FBSzBELG1CQUFtQixnQkFFOUI1QyxFQURQMkMsU0FBY3pELEtBQUswRCxtQkFBbUIsaUJBUTFDNUQsT0FBTzZELEVBQVczRCxLQUFLWSxVQUVyQixPQURBZ0QsS0FBSyxjQUFlRCxHQUNiM0QsS0FBS0ksYUFBYXlELGVBQWVGLEdBTTFDN0QsbUJBQW1CcUQsRUFBWSxnQkFDN0IsT0FBTyxJQUFJdEMsUUFBUXNCLE1BQU1yQixFQUFTQyxLQUNoQyxJQUFpQjRCLEVBU2pCLGFBUk0zQyxLQUFLNEMsZUFHWEQsRUFGYzNDLEtBQUtPLFdBQVdzQyxZQUFZLENBQUNNLEdBQVksYUFDN0JULFlBQVlTLEdBQ2hCVyxTQUNkNUIsUUFBVSxDQUFDZixJQUNqQm5CLEtBQUtPLFdBQVd3QyxRQUNUaEMsR0FBTyxLQUVUNEIsRUFBUVYsVUFBWSxDQUFDZCxJQUMxQm5CLEtBQUtPLFdBQVd3QyxRQUNUakMsR0FBUSJ9